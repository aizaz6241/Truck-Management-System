generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String
  phone     String?
  cnic      String?
  salary    String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  diesel    Diesel[]
  trips     Trip[]
}

model Vehicle {
  id                 Int        @id @default(autoincrement())
  number             String     @unique
  type               String
  model              String
  capacity           String
  status             String
  ownership          String     @default("RVT")
  ownerName          String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  registrationExpiry DateTime?
  taxiOwnerId        Int?
  diesel             Diesel[]
  trips              Trip[]
  taxiOwner          TaxiOwner? @relation(fields: [taxiOwnerId], references: [id])
}

model TaxiOwner {
  id         Int       @id @default(autoincrement())
  name       String
  email      String?
  phone      String?
  emiratesId String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  vehicles   Vehicle[]
}

model Trip {
  id                  Int         @id @default(autoincrement())
  fromLocation        String
  toLocation          String
  date                DateTime
  driverId            Int
  vehicleId           Int
  materialType        String?
  paperImage          String?
  createdAt           DateTime    @default(now())
  invoiceId           Int?
  serialNumber        String?
  companySerialNumber String?
  weight              String?
  contractorId        Int?
  driver              User        @relation(fields: [driverId], references: [id], onDelete: Cascade)
  invoice             Invoice?    @relation(fields: [invoiceId], references: [id])
  vehicle             Vehicle     @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  contractor          Contractor? @relation(fields: [contractorId], references: [id])
  images              TripImage[]
  paperStatus         String      @default("Not Handed")
}

model TripImage {
  id     Int    @id @default(autoincrement())
  url    String
  tripId Int
  trip   Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)
}

model Invoice {
  id              Int        @id @default(autoincrement())
  invoiceNo       String     @unique
  date            DateTime   @default(now())
  contractorId    Int
  totalAmount     Float
  paidAmount      Float      @default(0)
  status          String     @default("Unpaid")
  metadata        String?
  isReceived      Boolean    @default(false)
  receivedDate    DateTime?
  receivedCopyUrl String?
  letterhead      String?    @default("RVT")
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  contractor      Contractor @relation(fields: [contractorId], references: [id])
  payments        Payment[]
  trips           Trip[]
}

model Payment {
  id             Int      @id @default(autoincrement())
  invoiceId      Int
  date           DateTime @default(now())
  amount         Float
  type           String
  chequeImageUrl String?
  chequeNo       String?
  bankName       String?
  note           String?
  createdAt      DateTime @default(now())
  invoice        Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id        Int      @id @default(autoincrement())
  action    String
  entity    String
  entityId  String?
  details   String?
  actorId   Int
  actorName String
  actorRole String
  date      DateTime @default(now())
}

model Contractor {
  id                Int                  @id @default(autoincrement())
  name              String
  abbreviation      String?
  address           String?
  email             String?
  phone             String
  licenseNumber     String?
  contractStartDate DateTime?
  contractEndDate   DateTime?
  status            String               @default("Active")
  taxId             String?
  poBox             String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  documents         ContractorDocument[]
  materials         ContractorMaterial[]
  invoices          Invoice[]
  sites             Site[]
  statements        Statement[]
  trips             Trip[]
}

model ContractorMaterial {
  id           Int        @id @default(autoincrement())
  name         String
  contractorId Int
  contractor   Contractor @relation(fields: [contractorId], references: [id], onDelete: Cascade)
}

model ContractorDocument {
  id           Int        @id @default(autoincrement())
  name         String
  url          String
  type         String?
  contractorId Int
  createdAt    DateTime   @default(now())
  contractor   Contractor @relation(fields: [contractorId], references: [id], onDelete: Cascade)
}

model Site {
  id           Int            @id @default(autoincrement())
  name         String
  status       String         @default("Active")
  contractorId Int?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  contractor   Contractor?    @relation(fields: [contractorId], references: [id])
  materials    SiteMaterial[]
}

model SiteMaterial {
  id           Int    @id @default(autoincrement())
  name         String
  price        Float
  unit         String
  locationFrom String
  locationTo   String
  siteId       Int
  site         Site   @relation(fields: [siteId], references: [id], onDelete: Cascade)
}

model Statement {
  id           Int         @id @default(autoincrement())
  name         String
  date         DateTime    @default(now())
  type         String
  details      String?
  url          String?
  createdAt    DateTime    @default(now())
  contractorId Int?
  letterhead   String?     @default("RVT")
  contractor   Contractor? @relation(fields: [contractorId], references: [id])
}

model Diesel {
  id            Int      @id @default(autoincrement())
  vehicleId     Int
  driverId      Int?
  date          DateTime @default(now())
  liters        Float
  pricePerLiter Float
  totalAmount   Float
  odometer      Float?
  receiptUrl    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  driver        User?    @relation(fields: [driverId], references: [id])
  vehicle       Vehicle  @relation(fields: [vehicleId], references: [id])
}

model DismissedNotification {
  id         Int      @id @default(autoincrement())
  identifier String   @unique
  userId     Int?
  createdAt  DateTime @default(now())
}
